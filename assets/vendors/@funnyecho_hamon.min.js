!function(){"use strict";var t,n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},o={},e=n&&n.__extends||(t=function(n,o){return(t=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var o in n)n.hasOwnProperty(o)&&(t[o]=n[o])})(n,o)},function(n,o){function e(){this.constructor=n}t(n,o),n.prototype=null===o?Object.create(o):(e.prototype=o.prototype,new e)}),r=n&&n.__read||function(t,n){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var e,r,i=o.call(t),l=[];try{for(;(void 0===n||n-- >0)&&!(e=i.next()).done;)l.push(e.value)}catch(t){r={error:t}}finally{try{e&&!e.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return l},i=n&&n.__spread||function(){for(var t=[],n=0;n<arguments.length;n++)t=t.concat(r(arguments[n]));return t},l=n&&n.__values||function(t){var n="function"==typeof Symbol&&Symbol.iterator,o=n&&t[n],e=0;if(o)return o.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&e>=t.length&&(t=void 0),{value:t&&t[e++],done:!t}}};throw TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")};function a(t){var n=!1;return function(){for(var o=[],e=0;e<arguments.length;e++)o[e]=arguments[e];n||(n=!0,t.apply(void 0,i(o)))}}Object.defineProperty(o,"__esModule",{value:!0});var u=function(){function t(t){this.tapIdSeed=0,this.presetTapBucket=new Set,this.tapBuckets=new Map,this.tapOptionsCache=new Map,this.bucketHashcode=t}return t.prototype.exhaust=function(){this.presetTapBucket.clear(),this.tapBuckets.clear(),this.tapOptionsCache.clear()},t.prototype.destroy=function(){this.exhaust()},t.prototype.insertSyncTap=function(t,n){return this.tapping(t,n)},t.prototype.insertAsyncTap=function(t,n){return this.tapping(function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];var e=n[n.length-1];try{t.apply(void 0,i(n))}catch(t){e(t)}},n)},t.prototype.insertPromiseTap=function(t,n){return this.tapping(function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];var e=n.pop();try{Promise.resolve(t.apply(void 0,i(n))).then(function(t){e(null,t)},function(t){e(t)})}catch(t){e(t)}},n)},t.prototype.invokeSeries=function(t,n){n||(n={}),"function"==typeof n.onComplete&&(n.onComplete=a(n.onComplete)),function t(n,o,e){if(r="function"==typeof n.onComplete?n.onComplete:function(t,n){},!e.length){n.shouldWaterfall?r(null,o[0]):r(null,void 0);return}var r,l=e.shift(),a=Array.from(o),u=i(o,[function(o,i){if(null!=o){r(o);return}if(void 0!==i&&!0===n.shouldBail){r(null,i);return}void 0!==i&&!0===n.shouldWaterfall&&(a[0]=i),t(n,a,e)}]);l.fn.apply(l,i(u))}(n,t,Array.from(this.getBucketTaps(t)))},t.prototype.invokeParallel=function(t,n){n||(n={}),"function"==typeof n.onComplete&&(n.onComplete=a(n.onComplete)),function(t,n,o){if(a="function"==typeof t.onComplete?t.onComplete:function(t,n){},!o.length){a(null,void 0);return}var e,r,a,u=o.length,p=i(n,[function(o,e){if(null!=o){a(o);return}if(void 0!==e&&!0===t.shouldBail){a(null,e);return}if(--u<=0){a(null,n[0]);return}}]);try{for(var c=l(o),s=c.next();!s.done;s=c.next()){var f=s.value;f.fn.apply(f,i(p))}}catch(t){e={error:t}}finally{try{s&&!s.done&&(r=c.return)&&r.call(c)}finally{if(e)throw e.error}}}(n,t,Array.from(this.getBucketTaps(t)))},t.prototype.invokeSynchronously=function(t,n){return n||(n={}),function(t,n,o){if(!o.length)return t.shouldWaterfall?n[0]:void 0;var e,r,a=Array.from(n);try{for(var u=l(o),p=u.next();!p.done;p=u.next()){var c=p.value.fn.apply(void 0,i(a));if(void 0!==c&&!0===t.shouldBail)return c;void 0!==c&&!0===t.shouldWaterfall&&(a[0]=c)}}catch(t){e={error:t}}finally{try{p&&!p.done&&(r=u.return)&&r.call(u)}finally{if(e)throw e.error}}return t.shouldWaterfall?a[0]:void 0}(n,t,Array.from(this.getBucketTaps(t)))},t.prototype.getBucketTaps=function(t){var n,o,e=Array.from(this.presetTapBucket),r=[];if("function"==typeof this.bucketHashcode){var a=this.bucketHashcode.apply(this,i(t));this.tapBuckets.has(a)&&(r=Array.from(this.tapBuckets.get(a)))}var u=new Set(i(e,r)),p=new Set;try{for(var c=l(u),s=c.next();!s.done;s=c.next()){var f=s.value;p.add(this.tapOptionsCache.get(f))}}catch(t){n={error:t}}finally{try{s&&!s.done&&(o=c.return)&&o.call(c)}finally{if(n)throw n.error}}return p},t.prototype.tapping=function(t,n){var o=this,e=this.presetTapBucket;n&&(this.tapBuckets.has(n)||this.tapBuckets.set(n,new Set),e=this.tapBuckets.get(n));var r=this.generateTapId();return this.tapOptionsCache.set(r,{fn:t,bucket:n}),e.add(r),function(){o.popoutTap(r)}},t.prototype.popoutTap=function(t){var n=this.tapOptionsCache.get(t);if(n){var o=n.bucket;o?this.tapBuckets.has(o)&&this.tapBuckets.get(o).delete(t):this.presetTapBucket.delete(t),this.tapOptionsCache.delete(t)}},t.prototype.generateTapId=function(){return"tap:"+ ++this.tapIdSeed+"?"+Date.now()},t}();o.Hook=u;var p=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.tap=function(t,n){return this.insertSyncTap(t,n)},n}(u);o.SyncTapHook=p;var c=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.tapAsync=function(t,n){return this.insertAsyncTap(t,n)},n.prototype.tapPromise=function(t,n){return this.insertPromiseTap(t,n)},n}(u);o.AsyncTapHook=c;var s=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.call=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.invokeSynchronously(t)},n}(p),f=o.SyncHook=s,h=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.call=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return this.invokeSynchronously(t,{shouldBail:!0})},n}(p);o.SyncBailHook=h;var y=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.call=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return this.invokeSynchronously(t,{shouldWaterfall:!0})},n}(p);o.SyncWaterfallHook=y;var v=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.callAsync=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var o=t.pop();this.invokeParallel(t,{onComplete:function(t){null!=t?o(t):o()}})},n.prototype.callPromise=function(){for(var t=this,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return new Promise(function(o,e){t.invokeParallel(n,{onComplete:function(t){null!=t?e(t):o()}})})},n}(c);o.AsyncParallelHook=v;var d=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.callAsync=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var o=t.pop();this.invokeParallel(t,{shouldBail:!0,onComplete:o})},n.prototype.callPromise=function(){for(var t=this,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return new Promise(function(o,e){t.invokeParallel(n,{shouldBail:!0,onComplete:function(t,n){null!=t?e(t):o(n)}})})},n}(c);o.AsyncParallelBailHook=d;var k=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.callAsync=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var o=t.pop();this.invokeSeries(t,{onComplete:function(t){null!=t?o(t):o()}})},n.prototype.callPromise=function(){for(var t=this,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return new Promise(function(o,e){t.invokeSeries(n,{onComplete:function(t){null!=t?e(t):o()}})})},n}(c);o.AsyncSeriesHook=k;var m=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.callAsync=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var o=t.pop();this.invokeSeries(t,{shouldBail:!0,onComplete:o})},n.prototype.callPromise=function(){for(var t=this,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return new Promise(function(o,e){t.invokeSeries(n,{shouldBail:!0,onComplete:function(t,n){null!=t?e(t):o(n)}})})},n}(c),g=o.AsyncSeriesBailHook=m,S=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.callAsync=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var o=t.pop();this.invokeSeries(t,{shouldWaterfall:!0,onComplete:o})},n.prototype.callPromise=function(){for(var t=this,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return new Promise(function(o,e){t.invokeSeries(n,{shouldWaterfall:!0,onComplete:function(t,n){null!=t?e(t):o(n)}})})},n}(c);o.AsyncSeriesWaterfallHook=S,o.default={SyncHook:s,SyncBailHook:h,SyncWaterfallHook:y,AsyncSeriesHook:k,AsyncSeriesBailHook:m,AsyncSeriesWaterfallHook:S,AsyncParallelHook:v,AsyncParallelBailHook:d},window["@funnyecho/hamon"]={SyncHook:f,AsyncSeriesBailHook:g}}();
