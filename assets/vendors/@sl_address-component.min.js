!function(){"use strict";(b=T||(T={})).Country="country",b.Province="province",b.City="city",b.District="district",b.Name="name",b.FirstName="firstName",b.LastName="lastName",b.Mobile="mobile",b.Postcode="postcode",b.Company="company",b.Address="address",b.Address2="address2",(g=O||(O={}))[g.NAME=1]="NAME",g[g.FLName=2]="FLName",(w=A||(A={}))[w.Select=1]="Select",w[w.Input=2]="Input";let e=[T.Country,T.Province,T.City,T.District,T.Name,T.FirstName,T.LastName,T.Mobile,T.Postcode,T.Address,T.Address2,T.Company],t=Symbol("@ts-pattern/matcher"),r="@ts-pattern/anonymous-select-key",n=e=>!!(e&&"object"==typeof e),i=e=>e&&!!e[t],o=(e,r,a)=>{if(n(e)){if(i(e)){let{matched:n,selections:i={}}=e[t]().match(r);return n&&Object.keys(i).forEach(e=>a(e,i[e])),n}if(!n(r))return!1;if(Array.isArray(e))return!!Array.isArray(r)&&e.length===r.length&&e.every((e,t)=>o(e,r[t],a));if(e instanceof Map)return r instanceof Map&&Array.from(e.keys()).every(t=>o(e.get(t),r.get(t),a));if(e instanceof Set){if(!(r instanceof Set))return!1;if(0===e.size)return 0===r.size;if(1===e.size){let[t]=Array.from(e.values());return i(t)?Array.from(r.values()).every(e=>o(t,e,a)):r.has(t)}return Array.from(e.values()).every(e=>r.has(e))}return Object.keys(e).every(n=>{let l=e[n];return(n in r||i(l)&&"optional"===l[t]().matcherType)&&o(l,r[n],a)})}return Object.is(r,e)},a=e=>{var r,o,d;return n(e)?i(e)?null!=(r=null==(o=(d=e[t]()).getSelectionKeys)?void 0:o.call(d))?r:[]:Array.isArray(e)?l(e,a):l(Object.values(e),a):[]},l=(e,t)=>e.reduce((e,r)=>e.concat(t(r)),[]);function d(e){return{[t]:()=>({match:t=>({matched:!!e(t)})})}}d(function(e){return!0}),d(function(e){return"string"==typeof e}),d(function(e){return"number"==typeof e}),d(function(e){return"boolean"==typeof e}),d(function(e){return"bigint"==typeof e}),d(function(e){return"symbol"==typeof e}),d(function(e){return null==e});var u,s,c,p,f,y,h,m,v,b,g,w,T,O,A,C,M,N={union:function(...e){return{[t]:()=>({match:t=>{let r={},n=(e,t)=>{r[e]=t};return l(e,a).forEach(e=>n(e,void 0)),{matched:e.some(e=>o(e,t,n)),selections:r}},getSelectionKeys:()=>l(e,a),matcherType:"or"})}},select:function(...e){let n="string"==typeof e[0]?e[0]:void 0,i=2===e.length?e[1]:"string"==typeof e[0]?void 0:e[0];return{[t]:()=>({match:e=>{let t={[null!=n?n:r]:e};return{matched:void 0===i||o(i,e,(e,r)=>{t[e]=r}),selections:t}},getSelectionKeys:()=>[null!=n?n:r].concat(void 0===i?[]:a(i))})}}};let F=e=>L(e,[]),L=(e,t)=>{let n=()=>{let r=t.find(({test:t})=>t(e));if(!r){let t;try{t=JSON.stringify(e)}catch(r){t=e}throw Error(`Pattern matching error: no pattern matches value ${t}`)}return r.handler(r.select(e),e)};return{with(...n){let i=n[n.length-1],a=[],l=[];3===n.length&&"function"==typeof n[1]?(a.push(n[0]),l.push(n[1])):a.push(...n.slice(0,n.length-1));let d={};return L(e,t.concat([{test:e=>!!(a.some(t=>o(t,e,(e,t)=>{d[e]=t}))&&l.every(t=>t(e))),handler:i,select:e=>Object.keys(d).length?r in d?d[r]:d:e}]))},when:(r,n)=>L(e,t.concat([{test:r,handler:n,select:e=>e}])),otherwise:r=>L(e,t.concat([{test:()=>!0,handler:r,select:e=>e}])).run(),exhaustive:()=>n(),run:n}},j=[T.Country,T.Province,T.City,T.District];function S(e){return j.indexOf(e)>=0}function I(e){return`${e}Code`}function P(e){for(let t=j.length-1;t>=0;--t)if(j[t]===e)return j[t-1]}function _(e){for(let t=0;t<j.length;++t)if(j[t]===e)return j[t+1]}function E(e,t){if(e===t)return 1;let r=j.length-1;for(;r>=0&&j[r]!==e;)r-=1;if(r<0)return 0;let n=0;for(;n<j.length&&j[n]!==t;)n+=1;return n>=j.length||n>r?0:r-n+1}function D(e){return e?j.slice(1):[...j]}function B(){return{code:void 0,name:void 0}}function k(e){return F(e).with(T.Country,()=>({propKey:T.Country,interactionType:A.Select,priority:7,displayOrder:7,display:!0,required:!0,title:"Country/region",placeholder:"Country/region",remindCopywriter:"Select a country / region"})).with(T.Province,()=>({propKey:T.Province,interactionType:A.Select,priority:8,displayOrder:8,display:!0,required:!0,title:"State/province",placeholder:"State/province",remindCopywriter:"Select a state / province"})).with(T.City,()=>({propKey:T.City,interactionType:A.Input,priority:6,displayOrder:6,display:!0,required:!0,title:"City",placeholder:"City",remindCopywriter:"Enter a city"})).with(T.District,()=>({propKey:T.District,interactionType:A.Input,priority:9,displayOrder:9,display:!1,required:!1,title:"District",placeholder:"District",remindCopywriter:"Enter a district"})).with(T.Address,()=>({propKey:T.Address,interactionType:A.Input,priority:4,displayOrder:4,display:!0,required:!0,title:"Address",placeholder:"Address",remindCopywriter:"Enter an address"})).with(T.Address2,()=>({propKey:T.Address2,interactionType:A.Input,priority:5,displayOrder:5,display:!0,required:!1,title:"Address2",placeholder:"Apartment, suite, etc. (optional)",remindCopywriter:""})).with(T.Name,()=>({propKey:T.Name,interactionType:A.Input,priority:1,displayOrder:1,display:!1,required:!1,title:"Name",placeholder:"Name",remindCopywriter:"Enter a name"})).with(T.FirstName,()=>({propKey:T.FirstName,interactionType:A.Input,priority:2,displayOrder:2,display:!0,required:!0,title:"First name",placeholder:"First name",remindCopywriter:"Enter a first name"})).with(T.LastName,()=>({propKey:T.LastName,interactionType:A.Input,priority:3,displayOrder:3,display:!0,required:!0,title:"Last name",placeholder:"Last name",remindCopywriter:"Enter a last name"})).with(T.Mobile,()=>({propKey:T.Mobile,interactionType:A.Input,priority:11,displayOrder:11,display:!0,required:!0,title:"Phone",placeholder:"Phone",remindCopywriter:"Enter a valid phone number"})).with(T.Postcode,()=>({propKey:T.Postcode,interactionType:A.Input,priority:9,displayOrder:9,display:!0,required:!0,title:"ZIP code",placeholder:"ZIP code",remindCopywriter:"ZIP code"})).with(T.Company,()=>({propKey:T.Company,interactionType:A.Input,priority:12,displayOrder:12,display:!1,required:!1,title:"Company",placeholder:"Company",remindCopywriter:"Company"})).otherwise(e=>({propKey:e,interactionType:A.Input,priority:-1,displayOrder:-1,display:!1,required:!1,title:e,placeholder:e,remindCopywriter:""}))}function U(e){return!1!==e.display}function V(e){return e.interactionType===A.Select}function G(e){return Object.assign(Object.assign({},e),{interactionType:A.Input})}function K(e){return Object.assign(Object.assign({},e),{interactionType:A.Select})}function x(){return{country:"DEFAULT",nameType:O.FLName,props:e.map(e=>k(e))}}function q(e){let{country:t,nameType:r,props:n}=e,i=100,o=n.reduce((e,t)=>(e[t.propKey]=t,e),{}),a={forceFullNameMode:()=>(r=O.NAME,o[T.Name].display=!0,o[T.LastName].display=!1,o[T.FirstName].display=!1,a),forceFLNameMode:()=>(r=O.FLName,o[T.Name].display=!1,o[T.LastName].display=!0,o[T.FirstName].display=!0,a),hasField:e=>o.hasOwnProperty(e),setField(e){let{propKey:t}=e;return o.hasOwnProperty(t)||(o[t]=Object.assign(Object.assign({},e),{priority:i+=1})),a},build:()=>({country:t,nameType:r,props:Object.keys(o).map(e=>o[e]).sort((e,t)=>e.priority-t.priority)})};return a}function R(e){return{success:!0,code:C.SUCCESS,data:e}}function z(e,t,r){return{success:!1,code:e,msg:r}}function W(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function l(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(a,l)}d((n=n.apply(e,t||[])).next())})}function $(e,t){return F(e).with({type:"fieldUpdatedBlob",payload:N.select()},e=>e.candidates[0]).with({type:"fieldsUpdatedBlob",payload:N.select()},e=>e[t][0]).with({type:"addressInfoReplacedBlob",payload:N.select()},e=>e[t]||"").with({type:"addressInfoUpdatedBlob",payload:N.select()},e=>e[t]||"").otherwise(()=>"")}function Z(e,t,r){function n(e,t,r,i){if(!(i<1)&&Array.isArray(e)&&!(e.length<=0)){if(1===i){for(let n of e)if(!1===r(t,n))break;return}for(let o of e)n(o.subNodes||[],t,r,i-1)}}let i={};return!function e(t,r,n){if(n<1)return;t(r);let i=_(r);i&&e(t,i,n-1)}(r=>{i[r]={traverse(i){!function(r,i){let o=E(r,t);n(e,r,(e,t)=>{i(e,t)},o)}(r,i)},bailTraverse(i){!function(r,i){let o=E(r,t);n(e,r,i,o)}(r,i)}}},t,r),i}function H(){return{traverse(e){},bailTraverse(e){}}}function J(e,t){let r;if(null!=e)return e.bailTraverse((e,n)=>{if(n)for(let e=0;e<t.length;++e){let i=t[e];if(n.code===i)return r=n,!1}}),r||e.bailTraverse((e,n)=>{if(n)for(let e=0;e<t.length;++e){var i,o;let a=t[e];if(a&&(i=n.gCode||n.gcode||"",o=a.trim(),"string"==typeof i&&"string"==typeof o&&i.toLowerCase()===o.toLowerCase()))return r=n,!1}}),r||e.bailTraverse((e,n)=>{if(n)for(let e=0;e<t.length;++e){var i,o;let a=t[e];if(a&&(i=n.name||"",o=a.trim(),"string"==typeof i&&"string"==typeof o&&i.toLowerCase().indexOf(o.toLowerCase())>=0))return r=n,!1}}),r}(u=C||(C={})).SUCCESS="SUCCESS",u.FA_INVALID_PARAMS="FA_INVALID_PARAMS",u.FA_DOMAIN__INVALID_COUNTRY="FA_DOMAIN__INVALID_COUNTRY",u.FA_DOMAIN__INVALID_TEMPLATE="FA_DOMAIN__INVALID_TEMPLATE",(s=M||(M={}))[s.Nil=0]="Nil",s[s.Name=1]="Name",s[s.Logistics=2]="Logistics";let Y={[T.FirstName]:M.Name,[T.LastName]:M.Name,[T.Name]:M.Name,[T.Country]:M.Logistics,[T.Province]:M.Logistics,[T.City]:M.Logistics,[T.District]:M.Logistics,[T.Postcode]:M.Logistics};function Q(e,t){return{get country(){return e},get template(){return t},takeGroupModel:()=>X(function(e){let{props:t}=e,r=t.slice(0).sort((e,t)=>e.priority-t.priority),n=[];return r.reduce((e,t,i)=>{let o=e[e.length-1],a=i===r.length-1;return o?e.length<3&&Y[o]&&Y[o]===Y[t.propKey]?(e.push(t.propKey),a&&n.push(e),e):(n.push(e),a&&n.push([t.propKey]),[t.propKey]):(a&&n.push([t.propKey]),[t.propKey])},[]),n}(t)),takeGroupModelWithStringifyTemplate:e=>X(function*(e){let t=[],r={begin:-1,end:-1},n=(r,n)=>{let i=e.length-1;if(r<0||n<0||r>i||n>i||r>=n)return;let o=e.slice(r+1,n);o.length<=0||t.push(o)};for(let i=0;i<e.length;++i)switch(e[i]){case"{":r={begin:i,end:-1};break;case"}":r.end=i,n(r.begin,r.end);break;case"_":yield Array.from(t),t=[]}t.length>0&&(yield Array.from(t))}(e))}}function X(e){let t=[];for(let r of e)t.push({type:"Group",elements:r.map(e=>("address1"===e&&(e=T.Address),{type:"Element",fieldName:e}))});return{prependGroup(...e){let r=new Set(e);(t=er(t,e=>!r.has(e))).unshift(ee(e))},insertGroupBefore(e,...r){let n=new Set(r);t=er(t,e=>!n.has(e));let i=-1;t.forEach((t,r)=>{t&&"Group"===t.type&&t.elements.forEach(t=>{"Element"===t.type&&t.fieldName===e&&(i=r)})}),(i<0||i>=t.length)&&(i=t.length),t=[...t.slice(0,i),ee(r),...t.slice(i)]},build(){let e=[];return t.forEach(t=>{"Group"===t.type&&e.push(t.elements.map(e=>e.fieldName))}),e}}}function ee(e){return{type:"Group",elements:e.map(et)}}function et(e){return{type:"Element",fieldName:e}}function er(e,t){let r=[];return e.forEach(e=>{if(e&&"Group"===e.type){let n=function(e,t){if(!e)return null;let r=[];return(e.elements.forEach(e=>{e&&t(e.fieldName)&&r.push(e)}),r.length<=0)?null:{type:"Group",elements:r}}(e,t);n&&r.push(n)}}),r}function en(e,t){return e.levelValueMap[t]}function ei(e,t){return e.infoFieldSet.has(t)?e.infoFieldValueMap[t]:void 0}function eo(e,t){switch(t){case T.FirstName:case T.LastName:return e.addressTemplateNameMode===O.FLName;case T.Name:return e.addressTemplateNameMode===O.NAME;default:return!0}}var ea={initDomainState:function(e){let t={addressTemplate:e.addressTemplate,addressTemplateNameMode:e.addressTemplate.nameType,fieldLayoutGroup:e.fieldLayoutGroup,fieldTemplateMap:{},levelValueMap:j.reduce((e,t)=>(e[t]={code:void 0,name:void 0},e),{}),levelAddressBookTraverserMap:j.reduce((e,t)=>(e[t]=H(),e),{}),infoFieldSet:new Set,infoFieldValueMap:{}};return e.addressTemplate.props.forEach(e=>{F(e).with({propKey:N.union(...j)},e=>{t.fieldTemplateMap[e.propKey]=e}).otherwise(e=>{t.infoFieldSet.add(e.propKey),t.fieldTemplateMap[e.propKey]=e})}),t},withLevelField:function(e,t,r){let[n,i,o]=r([e.fieldTemplateMap[t],e.levelValueMap[t],e.levelAddressBookTraverserMap[t]]);return e=Object.assign({},e),V(n)&&o[t]?(e.levelAddressBookTraverserMap=Object.assign(Object.assign({},e.levelAddressBookTraverserMap),o),J(o[t],[i.code,i.name])||(i=B())):(i=U(n=G(n))?Object.assign(Object.assign({},B()),{name:i.name}):Object.assign({},B()),function(e,t){let r=!1;for(let n=0;n<j.length;++n)j[n]===t&&(r=!0),r&&e(j[n])}(t=>{var r;e.fieldTemplateMap=Object.assign(Object.assign({},e.fieldTemplateMap),{[t]:G(null===(r=e.fieldTemplateMap)||void 0===r?void 0:r[t])})},t)),e.fieldTemplateMap=Object.assign(Object.assign({},e.fieldTemplateMap),{[t]:n}),e.levelValueMap=Object.assign(Object.assign({},e.levelValueMap),{[t]:i}),e},withInfoField:function(e,t,r){let[n,i]=r([e.fieldTemplateMap[t]||k(t),e.infoFieldValueMap[t]]);return(e=Object.assign({},e)).infoFieldSet.has(t)||(e.infoFieldSet=new Set(e.infoFieldSet),e.infoFieldSet.add(t)),e.fieldTemplateMap=Object.assign(Object.assign({},e.fieldTemplateMap),{[t]:n}),e.infoFieldValueMap=Object.assign(Object.assign({},e.infoFieldValueMap),{[t]:U(n)?i:null}),e},getLevelInfo:en,getCountryCode:function(e){return en(e,T.Country).code},getInfoFieldValue:ei,getAddressInfo:function(e){let t={};for(let r of e.infoFieldSet){let n=ei(e,r)||"";switch(r){case T.Name:eo(e,T.Name)&&(t[T.Name]=n);break;case T.LastName:case T.FirstName:eo(e,r)&&(t[r]=n);break;default:t[r]=n}}return D().forEach(r=>{let n=en(e,r);t[I(r)]=n.code||"",t[r]=n.name||""}),t},getFieldTemplateLayout:function(e){let t=new Set,r={};for(let n of e.fieldLayoutGroup){let i=[];n.forEach(r=>{e.fieldTemplateMap[r]&&(eo(e,r)||r!==T.LastName||(r=T.Name),U(e.fieldTemplateMap[r])&&eo(e,r)&&(t.has(r)&&t.delete(r),t.add(r),i.push(r)))}),r=Object.assign(Object.assign({},r),function(e){let t={},r=[],n=[];return(e||[]).forEach((e,t)=>{let i=Math.floor(t/3),o=Math.floor(t/3);null==r[i]?r[i]=1:r[i]+=1,null==n[o]?n[o]=1:n[o]+=1}),(e||[]).forEach((e,i)=>{null==t[e]&&(t[e]={xs:24,md:24/(r[Math.floor(i/3)]||1),xl:24/(n[Math.floor(i/3)]||1)})}),t}(i))}let n=[];return[...e.infoFieldSet,...D()].forEach(e=>{t.has(e)||n.push(e)}),{get fieldTemplateLayout(){return r},get fieldTemplateSequence(){return[...t,...n.sort((t,r)=>e.fieldTemplateMap[t].priority-e.fieldTemplateMap[r].priority)]}}}};function el(e){function t(t,r){return W(this,void 0,void 0,function*(){let n,i,o=x(),a=yield e.getAddressTemplate(t||"DEFAULT");if(a.success&&(o=a.data),"function"==typeof(null==r?void 0:r.addressTemplateDecorator)){let e=q(o);r.addressTemplateDecorator(e),o=e.build()}return{addressTemplate:o,fieldLayoutGroup:(i=Q(t,o),"function"==typeof(null==r?void 0:r.fieldLayoutGroupDecorator)&&(n=r.fieldLayoutGroupDecorator(i)),n||(n=i.takeGroupModel()),n.build())}})}return{reduce(r,n,i){return W(this,void 0,void 0,function*(){let o;if(i.isClean())return R(r);let a=yield e.getCountryList();if(!a.success||a.data.length<=0){let e=yield t("DEFAULT",n);o=ea.initDomainState({addressTemplate:e.addressTemplate,fieldLayoutGroup:e.fieldLayoutGroup}),o=ea.withLevelField(o,T.Country,([e])=>[e,B(),Z([],T.Country,1)])}else{let e=Z(a.data.map(e=>({name:e.name,code:e.code,alias:"",pCode:"",gCode:e.code,zipCode:[]})),T.Country,1),l=i.diffAddressFieldInfo(T.Country);if("Changed"===l.type){let r=F(l.payload).with({type:"fieldUpdatedBlob",payload:N.select()},e=>e.candidates[0]).with({type:"fieldsUpdatedBlob",payload:N.select()},e=>e[T.Country][0]).with({type:"addressInfoReplacedBlob",payload:N.select()},e=>e.countryCode||"").with({type:"addressInfoUpdatedBlob",payload:N.select()},e=>e.countryCode||"").otherwise(()=>""),i=r?a.data.find(e=>e.code===r):null;if(null==i){let r=yield t("DEFAULT",n);o=ea.initDomainState({addressTemplate:r.addressTemplate,fieldLayoutGroup:r.fieldLayoutGroup}),o=ea.withLevelField(o,T.Country,([t])=>[t,B(),e])}else{let r=yield t(i.code,n);o=ea.initDomainState({addressTemplate:r.addressTemplate,fieldLayoutGroup:r.fieldLayoutGroup}),o=ea.withLevelField(o,T.Country,([t])=>[t,i,e])}}else{let i=yield t(ea.getCountryCode(r),n);o=ea.initDomainState({addressTemplate:i.addressTemplate,fieldLayoutGroup:i.fieldLayoutGroup}),o=ea.withLevelField(o,T.Country,([t])=>[t,r.levelValueMap[T.Country],e])}}for(let t of D(!0))o=yield function(t,r,n,i){return W(this,void 0,void 0,function*(){let o=r.fieldTemplateMap[n],a=i.diffAddressFieldInfo(n);if(!V(o))return ea.withLevelField(r,n,([e])=>[G(e),F(a).with({type:"Changed",payload:N.select()},e=>Object.assign(Object.assign({},B()),{name:$(e,n)})).otherwise(()=>V(t.fieldTemplateMap[n])?B():Object.assign(Object.assign({},t.levelValueMap[n]),{code:void 0})),{}]);if(!U(o))return r;let l=function(e,t){let r=1,n=P(t);for(;null!=n;){let t=e.fieldTemplateMap[n];if(!V(t))break;if(U(t))return{fieldName:n,addressCode:e.levelValueMap[n].code||"",depth:r};r+=1,n=P(n)}return null}(r,n);if(null==l)return ea.withLevelField(r,n,([e])=>[G(e),F(a).with({type:"Changed",payload:N.select()},e=>Object.assign(Object.assign({},B()),{name:$(e,n)})).otherwise(()=>Object.assign(Object.assign({},t.levelValueMap[n]),{code:void 0})),{}]);let d=ea.getCountryCode(r);if(!d||!l.addressCode)return ea.withLevelField(r,n,([e])=>[K(e),B(),{[n]:H()}]);let u=yield e.getAddressBook(d,l.fieldName,l.addressCode,l.depth);if(!u.success||u.data.length<=0)return ea.withLevelField(r,n,([e])=>[G(e),F(a).with({type:"Changed",payload:N.select()},e=>Object.assign(Object.assign({},B()),{name:$(e,n)})).otherwise(()=>Object.assign(Object.assign({},t.levelValueMap[n]),{code:void 0})),{}]);let s=Z(u.data,_(l.fieldName),l.depth);return ea.withLevelField(r,n,([e])=>[K(e),F(a).with({type:"Changed",payload:N.select()},e=>{let t=J(s[n],F(e).with({type:"fieldUpdatedBlob",payload:N.select()},e=>e.candidates).with({type:"fieldsUpdatedBlob",payload:N.select()},e=>e[n]||[]).with({type:N.union("addressInfoUpdatedBlob","addressInfoReplacedBlob"),payload:N.select()},e=>[S(n)&&e[I(n)]||"",e[n]||""]).otherwise(()=>[]));return t?{code:t.code,name:t.name}:B()}).otherwise(()=>{let e=ea.getLevelInfo(t,n),r=J(s[n],[e.code,e.name]);return r?{code:r.code,name:r.name}:B()}),s])})}(r,o,t,i);for(let e of D(!0).reverse())o=yield function(e,t,r,n){return W(this,void 0,void 0,function*(){if(!function(e,t,r,n){let i=t.fieldTemplateMap[r];if(!V(i)||U(i))return!1;let o=_(r);return!!o&&V(t.fieldTemplateMap[o])&&!!ea.getLevelInfo(t,o).code}(0,t,r))return t;let e=_(r);if(!e)return t;let n=ea.getLevelInfo(t,e),i=J(t.levelAddressBookTraverserMap[e],[n.code]);if(!i)return t;let o=i.parentCode||i.pCode||i.pcode;if(!o)return t;let a=J(t.levelAddressBookTraverserMap[r],[o]);return a?ea.withLevelField(t,r,([e,t,n])=>[e,{code:a.code,name:a.name},{[r]:n}]):t})}(0,o,e);for(let e of o.infoFieldSet)o=yield function(e,t,r,n,i){return W(this,void 0,void 0,function*(){let o=n.diffAddressFieldInfo(r);return ea.withInfoField(t,r,([t,n])=>{if("function"==typeof(null==i?void 0:i.fieldTemplateDecorator)){let e=i.fieldTemplateDecorator(r,t);null!=e&&(t=Object.assign(Object.assign({},t),{display:e.display}))}return[t,F(o).with({type:"Changed",payload:N.select()},e=>$(e,r)).otherwise(()=>ea.getInfoFieldValue(e,r))]})})}(r,o,e,i,n);return R(o=yield function(e,t,r){return W(this,void 0,void 0,function*(){if(!(!ea.getInfoFieldValue(t,T.Postcode)&&F(r.diffAddressFieldInfo(T.Postcode)).with({type:"Changed",payload:N.select()},e=>F(e).with({type:N.union("fieldUpdatedBlob","fieldsUpdatedBlob")},e=>!1).otherwise(()=>!0)).otherwise(()=>!0)))return t;let e=T.District;do{if(null!=e&&V(t.fieldTemplateMap[e])){let r=J(t.levelAddressBookTraverserMap[e],[ea.getLevelInfo(t,e).code]);if(r){"string"==typeof r.zipCode&&r.zipCode?t.infoFieldValueMap[T.Postcode]=r.zipCode:Array.isArray(r.zipCode)&&r.zipCode[0]&&(t.infoFieldValueMap[T.Postcode]=r.zipCode[0]);break}}e=P(e)}while(e);return t})}(0,o,i))})}}}function ed(e,t){let r=ea.getFieldTemplateLayout(e),n={get addressInfo(){return ea.getAddressInfo(e)},get addressTemplate(){return e.addressTemplate},get fieldTemplateMap(){return Object.assign({},e.fieldTemplateMap)},get fieldAddressBookTraverser(){return Object.assign({},e.levelAddressBookTraverserMap)},fieldTemplateLayout:r.fieldTemplateLayout,fieldTemplateSequence:r.fieldTemplateSequence,get fieldAddressBookMap(){return D().reduce((t,r)=>{let n=e.levelAddressBookTraverserMap[r];return Object.defineProperty(t,r,{enumerable:!0,configurable:!0,get(){let e=[];return n&&n.traverse((t,r)=>{let n=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)0>t.indexOf(n[i])&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r}(r,["subNodes"]);e.push(n)}),e}}),t},{})},traverseAddressLevelField(t){D().forEach(r=>t(r,e.fieldTemplateMap[r]))},traverseAddressInfoField(t){e.infoFieldSet.forEach(r=>t(r,e.fieldTemplateMap[r]))},traverseAddressField(e){n.traverseAddressLevelField(e),n.traverseAddressInfoField(e)},bailTraverseAddressLevelField(t,r){let n=D();for(let r=0;r<n.length;++r){let i=n[r],o=t(i,e.fieldTemplateMap[i]);if(void 0!==o)return o}return r}};return n}function eu(e){let t,r;return function(...n){if(t&&function e(t,r){if(t===r)return!0;if(null==t||null==r)return!1;let n=typeof t;if(n!==typeof r||"function"===n)return!1;if(Array.isArray(t)&&Array.isArray(r)){let n=t.length,i=r.length;if(n!==i)return!1;let o=0;for(;o<n;++o)if(!e(t[o],r[o]))return!1;return o===i}return!1}(t,n)&&r)return r;t=n,r=void 0;let i=e.apply(this,n);return r=i,i&&"object"==typeof i&&(i instanceof Promise||"function"==typeof i.then)&&i&&"object"==typeof i&&(i instanceof Promise||"function"==typeof i.catch)&&i.catch(e=>{t===n&&r===i&&(t=void 0,r=void 0)}),i}}function es(e){let t=function(e){return{getAddressTemplate:eu(t=>W(this,void 0,void 0,function*(){let r=yield e.getAddressTemplate(t).catch(e=>(console.error("failed to get getAddressTemplate",e),z("FA_ADDRESS_UNKNOWN")));return r.success?Object.assign(Object.assign({},r),{data:Object.assign(Object.assign({},r.data),{props:r.data.props.map(e=>"address1"===e.propKey?Object.assign(Object.assign({},e),{propKey:T.Address}):e)})}):r}))}}(e.addressTemplateFetcher),r=function(e){let t={};return{getAddressBook:(r,n,i,o)=>(function(r,n,i,o){let a=`${r}__${n}__${o||1}`;return null==t[a]&&(t[a]={getAddressBook:eu((t,r,n,i)=>e.getAddressBook(t,r,n,i).catch(e=>(console.error("failed to get getAddressBook",e),z("FA_ADDRESS_UNKNOWN"))))}),t[a]})(r,n,0,o).getAddressBook(r,n,i,o)}}(e.addressBookFetcher),n=function(e){let t=eu(e.getCountryList);return{getCountryList:()=>t().catch(e=>(console.error("failed to get getCountryList",e),z("FA_ADDRESS_UNKNOWN")))}}(e.countrySource);return{get port(){return Object.assign(Object.assign(Object.assign({},n),t),r)}}}let ec="Defer",ep="Blocking";var ef="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},ey={},eh={},em={},ev=ef&&ef.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function l(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(a,l)}d((n=n.apply(e,t||[])).next())})},eb=ef&&ef.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(o){return function(l){return function(o){if(r)throw TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}};Object.defineProperty(em,"__esModule",{value:!0});var eg=new Promise(function(e){});em.default={zombie:eg,resolvable:function(){var e,t=!1;return[new Promise(function(r){t?r():e=r}),function(){t=!0,"function"==typeof e&&e()}]},resolveAfterEventBubbled:function(e,t){return ev(this,void 0,void 0,function(){return eb(this,function(r){return[2,new Promise(function(r){var n=function(i){e.removeEventListener(t,n),r(i)};e.addEventListener(t,n)})]})})},resolveAfterSeconds:function(e){return ev(this,void 0,void 0,function(){return eb(this,function(t){return e<=0?[2,Promise.resolve()]:[2,new Promise(function(t){setTimeout(function(){t()},1e3*e)})]})})},resolveAfterDuration:function(e){return ev(this,void 0,void 0,function(){return eb(this,function(t){return e<=0?[2,Promise.resolve()]:[2,new Promise(function(t){setTimeout(function(){t()},e)})]})})}};var ew={};Object.defineProperty(ew,"__esModule",{value:!0});var eT=function(){function e(e){this.v=e}return Object.defineProperty(e.prototype,"timestamp",{get:function(){return this.v},enumerable:!1,configurable:!0}),e.prototype.add=function(t){return new e(this.v+t)},e.prototype.sub=function(t){return new e(this.v-t)},e.prototype.duration=function(e){return this.v-e.timestamp},e}();function eO(e){return new eT(e)}function eA(){return eO(Date.now())}ew.default={time:eO,now:eA,later:function(e){return eA().add(e)},former:function(e){return eA().sub(e)},Millisecond:1,Second:1e3,Minute:6e4,Hour:36e5,Day:864e5,Week:6048e5};var eC={};Object.defineProperty(eC,"__esModule",{value:!0}),eC.default={errCanceled:"context done with cancellation",errTimeout:"context done with timeout",errDeadline:"context done with deadline",errNotNullableValuer:"valuer is not nullable"};var eM=ef&&ef.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(eh,"__esModule",{value:!0});var eN=eM(em),eF=eM(ew),eL=eM(eC);function ej(){return{deadline:function(){return null},done:function(){return eN.default.zombie},err:function(){return null},value:function(e){return e?e.defaultGetter():null}}}function eS(e){return e||(e=eP),{deadline:function(){return e.deadline()},done:function(){return e.done()},err:function(){return e.err()},value:function(t){return e.value(t)}}}function eI(e){var t=eN.default.resolvable(),r=t[0],n=t[1],i=null;return[{deadline:function(){return e.deadline()},done:function(){return Promise.race([e.done().then(function(){return e.err()}),r.then(function(){return Error(eL.default.errCanceled)})]).then(function(e){i=e})},err:function(){return i},value:function(t){return e.value(t)}},n]}eh.default={background:function(){return eS(eP)},todo:function(){return eS(e_)},withValue:function(e,t,r){return{deadline:function(){return e.deadline()},done:function(){return e.done()},err:function(){return e.err()},value:function(n){return t===n?r:e.value(n)}}},withCancel:function(e){return eI(e)},withTimeout:function(e,t){var r,n,i;return eI((n=eF.default.later(t),i=eN.default.resolveAfterDuration(t),{deadline:function(){return n},done:function(){return Promise.race([e.done().then(function(){return e.err()}),i.then(function(){return Error(eL.default.errTimeout)})]).then(function(e){r=e})},err:function(){return r},value:function(t){return e.value(t)}}))},withDeadline:function(e,t){var r,n;return eI((r=null,n=eN.default.resolveAfterDuration(t.duration(eF.default.now())),{deadline:function(){return t},done:function(){return Promise.race([e.done().then(function(){return e.err()}),n.then(function(){return Error(eL.default.errDeadline)})]).then(function(e){r=e})},err:function(){return r},value:function(t){return e.value(t)}}))}};var eP=ej(),e_=ej(),eE={},eD=ef&&ef.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(eE,"__esModule",{value:!0});var eB=eD(eC);function ek(e){return Object.defineProperty({},"defaultGetter",{value:e,writable:!1,configurable:!1})}eE.default={newValuer:function(e){return ek(void 0===e?function(){throw Error(eB.default.errNotNullableValuer)}:function(){return e})},newValuerWithGetter:function(e){return"function"!=typeof e&&(e=function(){throw Error(eB.default.errNotNullableValuer)}),ek(e)}},c=ef&&ef.__assign||function(){return(c=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},p=ef&&ef.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),f=ef&&ef.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||p(t,e,r)},y=ef&&ef.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},Object.defineProperty(ey,"__esModule",{value:!0}),h=y(eh),m=y(eC),v=y(eE),f(eh,ey),f(eE,ey),ey.default=c(c(c({},m.default),h.default),v.default);var eU=ey&&ey.__esModule&&Object.prototype.hasOwnProperty.call(ey,"default")?ey.default:ey;window["@sl/address-component"]={createHost:function(e){var t,r,n;let i;let o=q((null===(t=null==e?void 0:e.initState)||void 0===t?void 0:t.addressTemplate)||x());"function"==typeof(null===(r=null==e?void 0:e.initProps)||void 0===r?void 0:r.addressTemplateDecorator)&&e.initProps.addressTemplateDecorator(o);let a=o.build(),l=Q(a.country,a);"function"==typeof(null===(n=null==e?void 0:e.initProps)||void 0===n?void 0:n.fieldLayoutGroupDecorator)&&(i=null==e?void 0:e.initProps.fieldLayoutGroupDecorator(l)),null==i&&(i=l.takeGroupModel());let d=ea.initDomainState({addressTemplate:a,fieldLayoutGroup:i.build()}),u=e.initProps||{},s=ed(d),c=es(e.adapter),p=function(){let e=new Set;return{next(t){e.forEach(e=>{"function"==typeof e&&e(t)})},subscribe:t=>(e.add(t),{unsubscribe(){e.delete(t)}})}}(),f=el(c.port),y=function(e){let t=[],r=[],n=function(e,t){var r;let n={pending:!1,scheduled:!1},i=(r=()=>{n.pending=!1,o()},{tick(e){e().finally(()=>{r()})}}),o=()=>{!n.pending&&n.scheduled&&(n.scheduled=!1,n.pending=!0,i.tick(e))};return{tick(e){switch(e){case ec:var r;n.scheduled=!0,setTimeout(()=>{o()},("number"!=typeof(r=null==t?void 0:t.deferTimeout)&&(r=Number(r)),(r!=r||r<0)&&(r=10),r));return;case ep:n.scheduled=!0,o();return;default:return}}}}(()=>W(this,void 0,void 0,function*(){let n=t.slice(0);for(;n.length>0;)yield e(n),t.splice(0,n.length),n=t.slice(0);r.splice(0).forEach(e=>{"function"==typeof e&&e()})}),{deferTimeout:10});return{add(e){console.debug("add address blob stream",JSON.stringify(e,null,2)),t.push(e),F(F(e).with({type:N.union("addressInfoReplacedBlob","addressInfoUpdatedBlob","fieldsUpdatedBlob")},e=>ep).with({type:"fieldUpdatedBlob",payload:N.select()},e=>Reflect.has(e,T.Country)?ep:ec).otherwise(()=>ec)).with(ep,()=>n.tick(ep)).otherwise(()=>n.tick(ec))},exhaust:()=>t.length<=0?Promise.resolve():new Promise(e=>{r.push(e)})}}(e=>W(this,void 0,void 0,function*(){let t=function(e){var t;let r=(t=e.reverse(),function(e){for(let r of t){let t=e(r);if(void 0!==t)return t}});function n(e){return void 0!==e?{type:"Changed",payload:e}:{type:"Clean"}}return{isClean:()=>e.length<=0,diffDomainProps:()=>n(r(e=>F(e).with({type:"domainPropsUpdatedBlob"},e=>e).otherwise(()=>void 0))),diffAddressFieldInfo:e=>n(r(t=>F(t).with({type:"fieldUpdatedBlob",payload:{fieldName:e}},e=>e).with({type:"fieldsUpdatedBlob"},({payload:t})=>null!=t[e],e=>e).with({type:"addressInfoUpdatedBlob"},({payload:t})=>S(e)&&null!=t[I(e)]||null!=t[e],e=>e).with({type:"addressInfoReplacedBlob"},e=>e).otherwise(()=>void 0)))}}(e),r=u,n=t.diffDomainProps();"Changed"===n.type&&(r=n.payload.payload);let i=yield f.reduce(d,r,t);i.success?(d=i.data,s=ed(i.data),p.next(s),u=r):p.next(s)})),h={init(){var t;return y.add({type:"addressInfoReplacedBlob",payload:(null===(t=e.initState)||void 0===t?void 0:t.addressInfo)||{}}),h.exhaustModel()},getModel:()=>s,exhaustModel:()=>y.exhaust().then(()=>s),observeModel:(e,t)=>(!0===t&&setTimeout(()=>{e(s)},0),p.subscribe(e)),updateAdapter(e){h.exhaustModel().finally(()=>{f=el((c=es(e)).port),h.updateFieldsValue({})})},updateProps(e){let t;t="function"==typeof e?e(u):e,y.add({type:"domainPropsUpdatedBlob",payload:t})},updateFieldValue(e,...t){y.add({type:"fieldUpdatedBlob",payload:{fieldName:e,candidates:t}})},updateFieldsValue(e){y.add({type:"fieldsUpdatedBlob",payload:Object.keys(e).reduce((t,r)=>(t[r]=[e[r]],t),{})})},updateFieldsValueWithCandidates(e){y.add({type:"fieldsUpdatedBlob",payload:Object.keys(e).reduce((t,r)=>(t[r]=e[r],t),{})})},updateAddressInfo(e){y.add({type:"addressInfoUpdatedBlob",payload:e})},clearAddressInfo(){y.add({type:"addressInfoReplacedBlob",payload:{}})},replaceAddressInfo(e){y.add({type:"addressInfoReplacedBlob",payload:e})}};return h},distinctUntil:function(e,t,r,n){var i;let o,[a,l]=eU.withCancel(eU.background()),[d,u]=eU.withCancel(a),s=(i=([e,n])=>{if("function"==typeof t&&t(e,n)){let[e,t]=eU.withCancel(a);u(),d.done().finally(()=>{r(e,n)}),d=e,u=t}},e.observeModel(e=>{let t=(null==o?void 0:o.addressInfo)||{},r=e.addressInfo,n=new Set(Object.keys(t)),a=new Set(Object.keys(r)),l={};a.forEach(e=>{n.has(e)&&t[e]===r[e]||(l[e]=r[e]||null),n.delete(e)}),n.forEach(e=>{l[e]=null}),i([o,e,l]),o=e},n));return a.done().finally(()=>{s.unsubscribe()}),{unsubscribe(){l()}}},"/domain-model":{FieldNameEnum:T,FieldInteractionEnum:A}}}();
